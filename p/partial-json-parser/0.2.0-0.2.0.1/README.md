# Comparing `tmp/partial_json_parser-0.2.0.tar.gz` & `tmp/partial_json_parser-0.2.0.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "partial_json_parser-0.2.0.tar", last modified: Tue Mar 19 23:48:27 2024, max compression
+gzip compressed data, was "partial_json_parser-0.2.0.1.tar", last modified: Fri May 10 16:09:47 2024, max compression
```

## Comparing `partial_json_parser-0.2.0.tar` & `partial_json_parser-0.2.0.1.tar`

### file list

```diff
@@ -1,8 +1,10 @@
--rw-r--r--   0        0        0     4349 2024-03-19 22:29:06.717053 partial_json_parser-0.2.0/README.md
--rw-r--r--   0        0        0     1430 2024-03-19 23:48:27.087204 partial_json_parser-0.2.0/pyproject.toml
--rw-r--r--   0        0        0     7307 2024-03-19 22:48:20.230970 partial_json_parser-0.2.0/src/partial_json_parser/__init__.py
--rw-r--r--   0        0        0      992 2023-10-29 18:17:13.154277 partial_json_parser-0.2.0/src/partial_json_parser/options.py
--rw-r--r--   0        0        0      671 2023-10-29 17:45:09.270381 partial_json_parser-0.2.0/src/partial_json_parser/playground.py
--rw-r--r--   0        0        0     2072 2024-03-19 22:42:39.200991 partial_json_parser-0.2.0/tests/test_examples.py
--rw-r--r--   0        0        0     1332 2024-03-19 22:49:33.408876 partial_json_parser-0.2.0/tests/test_hypotheses.py
--rw-r--r--   0        0        0     4839 1970-01-01 00:00:00.000000 partial_json_parser-0.2.0/PKG-INFO
+-rw-r--r--   0        0        0     4349 2024-03-19 22:29:06.717053 partial_json_parser-0.2.0.1/README.md
+-rw-r--r--   0        0        0     1432 2024-05-10 16:09:47.050000 partial_json_parser-0.2.0.1/pyproject.toml
+-rw-r--r--   0        0        0     7748 2024-05-10 16:04:30.655203 partial_json_parser-0.2.0.1/src/partial_json_parser/__init__.py
+-rw-r--r--   0        0        0      992 2024-04-03 08:20:30.049307 partial_json_parser-0.2.0.1/src/partial_json_parser/options.py
+-rw-r--r--   0        0        0     1132 2024-05-10 13:51:09.110094 partial_json_parser-0.2.0.1/src/partial_json_parser/playground.py
+-rw-r--r--   0        0        0    19024 2024-05-10 15:51:01.796128 partial_json_parser-0.2.0.1/tests/__pycache__/test_examples.cpython-312-pytest-7.4.4.pyo
+-rw-r--r--   0        0        0     4870 2024-05-10 15:51:01.804081 partial_json_parser-0.2.0.1/tests/__pycache__/test_hypotheses.cpython-312-pytest-7.4.4.pyo
+-rw-r--r--   0        0        0     2353 2024-05-10 16:04:23.967712 partial_json_parser-0.2.0.1/tests/test_examples.py
+-rw-r--r--   0        0        0     1332 2024-05-10 16:04:30.655203 partial_json_parser-0.2.0.1/tests/test_hypotheses.py
+-rw-r--r--   0        0        0     4841 1970-01-01 00:00:00.000000 partial_json_parser-0.2.0.1/PKG-INFO
```

### Comparing `partial_json_parser-0.2.0/README.md` & `partial_json_parser-0.2.0.1/README.md`

 * *Files identical despite different names*

### Comparing `partial_json_parser-0.2.0/pyproject.toml` & `partial_json_parser-0.2.0.1/pyproject.toml`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [project]
 name = "partial-json-parser"
-version = "0.2.0"
+version = "0.2.0.1"
 description = "Parse partial JSON generated by LLM"
 authors = [
     { name = "Muspi Merol", email = "me@promplate.dev" },
 ]
 dependencies = []
 requires-python = ">=3.6"
 readme = "README.md"
```

### Comparing `partial_json_parser-0.2.0/src/partial_json_parser/__init__.py` & `partial_json_parser-0.2.0.1/src/partial_json_parser/__init__.py`

 * *Files 6% similar despite different names*

```diff
@@ -31,15 +31,18 @@
         raise TypeError(f"Expected str, got {type(json_string).__name__}")
     if not json_string.strip():
         raise ValueError(f"{json_string!r} is empty")
     return _parse_json(json_string.strip(), Allow(allow_partial), parser)
 
 
 def _parse_json(json_string: str, allow: Allow, parser: Callable[[str], JSON]):
-    result = complete_any(json_string, allow, is_top_level=True)  # setting is_top_level to True to treat literal numbers as complete
+    try:
+        result = complete_any(json_string, allow, is_top_level=True)  # setting is_top_level to True to treat literal numbers as complete
+    except (AssertionError, IndexError) as err:
+        raise MalformedJSON(*err.args) from err
     if result is False:
         raise PartialJSON
     if result[1] is True:
         return parser(json_string[: result[0]])
     return parser(json_string[: result[0]] + result[1])
 
 
@@ -105,44 +108,56 @@
 
     raise MalformedJSON(f"Unexpected character {char}")
 
 
 def complete_str(json_string: str, allow: Allow) -> CompleteResult:
     assert json_string[0] == '"'
 
+    length = len(json_string)
+
     i = 1
-    escaped = False
+    last_escaped = -1  # because `str.rfind` returns -1 if not found
 
     try:
-        while json_string[i] != '"' or escaped:
-            escaped = not escaped if json_string[i] == "\\" else False
-            i += 1
+        while True:
+            char = json_string[i]
 
-        return i + 1, True
+            if char == "\\":
+                last_escaped = i + 1
+                if last_escaped == length:
+                    raise IndexError
+                else:
+                    i += 2
+                    continue
+
+            elif char == '"':
+                return i + 1, True
+
+            i += 1
 
     except IndexError:
         if STR not in allow:
             return False
 
         # \uXXXX
         _u = json_string.rfind("\\u", max(0, i - 5), i)
-        if _u != -1:
+        if last_escaped != _u != -1:
             return _u, '"'
 
         # \UXXXXXXXX
         _U = json_string.rfind("\\U", max(0, i - 9), i)
-        if _U != -1:
+        if last_escaped != _U != -1:
             return _U, '"'
 
         # \xXX
         _x = json_string.rfind("\\x", max(0, i - 3), i)
-        if _x != -1:
+        if last_escaped != _x != -1:
             return _x, '"'
 
-        return i - escaped, '"'
+        return i, '"'
 
 
 def complete_arr(json_string: str, allow: Allow) -> CompleteResult:
     assert json_string[0] == "["
     i = j = 1
 
     try:
```

### Comparing `partial_json_parser-0.2.0/src/partial_json_parser/options.py` & `partial_json_parser-0.2.0.1/src/partial_json_parser/options.py`

 * *Files identical despite different names*

### Comparing `partial_json_parser-0.2.0/tests/test_examples.py` & `partial_json_parser-0.2.0.1/tests/test_examples.py`

 * *Files 4% similar despite different names*

```diff
@@ -7,14 +7,17 @@
 
 
 def test_str():
     assert parse_json('"', STR) == ""
     with raises(PartialJSON):
         parse_json('"', ~STR)
 
+    assert parse_json(r'"\\') == "\\"
+    assert parse_json(r'"\\u') == "\\u"
+
 
 def test_arr():
     assert parse_json('["', ARR) == []
     assert parse_json('["', ARR | STR) == [""]
 
     with raises(PartialJSON):
         parse_json("[", STR)
@@ -71,7 +74,16 @@
 
 
 def test_num():
     assert parse_json("0", ~NUM) == 0
     assert parse_json("-1.25e+4", ~NUM) == -1.25e4
     assert parse_json("-1.25e+", NUM) == -1.25
     assert parse_json("-1.25e", NUM) == -1.25
+
+
+def test_error():
+    with raises(MalformedJSON):
+        parse_json("a")
+    with raises(MalformedJSON):
+        parse_json("{0")
+    with raises(MalformedJSON):
+        parse_json("--")
```

### Comparing `partial_json_parser-0.2.0/tests/test_hypotheses.py` & `partial_json_parser-0.2.0.1/tests/test_hypotheses.py`

 * *Files identical despite different names*

### Comparing `partial_json_parser-0.2.0/PKG-INFO` & `partial_json_parser-0.2.0.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 Metadata-Version: 2.1
 Name: partial-json-parser
-Version: 0.2.0
+Version: 0.2.0.1
 Summary: Parse partial JSON generated by LLM
-Keywords: JSON parser LLM nlp
+Keywords: JSON,parser,LLM,nlp
 Home-page: https://promplate.dev/partial-json-parser
 Author-Email: Muspi Merol <me@promplate.dev>
 License: MIT
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
 Project-URL: Repository, https://github.com/promplate/partial-json-parser
 Project-URL: Homepage, https://promplate.dev/partial-json-parser
```

